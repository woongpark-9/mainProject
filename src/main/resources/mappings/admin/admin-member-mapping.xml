<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="AdminMemberDAO">
	<resultMap type="adminmember" id="memberResult">
		<result property="email" column="email" />
		<result property="seq" column="seq" />
		<result property="nickname" column="nickname" />
		<result property="birth" column="birth" />
		<result property="age" column="age" />
		<result property="gender" column="gender" />
		<result property="cert" column="cert" />
		<result property="ban" column="ban" />
		<result property="genre" column="genre" />
		<result property="join_date" column="join_date" />
		<result property="ticket_id" column="ticket_id" />
		<result property="kakao" column="kakao" />
		<result property="naver" column="naver" />
		<result property="rownum" column="rownum" />
	</resultMap>

	<select id="getMemberList" parameterType="hashMap"
		resultMap="memberResult">
		select (row_number() over()) AS rownum, seq, email,
		nickname,age,gender,ticket_id,cert,ban,join_date
		from(
		select seq,
		email, nickname, age, gender, ticket_id, cert,ban,join_date
		from member
		where 1=1
		<if test="searchCondition=='email'">
			AND email LIKE '%'||#{searchKeyword}||'%'
		</if>
		<if test="searchCondition=='nickname'">
			AND nickname LIKE '%'||#{searchKeyword}||'%'
		</if>

		order by seq) st
		order by rownum desc limit #{row} offset
		#{startPoint}
	</select>

	<select id="getTotalCount" parameterType="hashMap"
		resultType="int">
		select count(*) from member
		where 1=1
		<if test="searchCondition=='email'">
			AND email LIKE '%'||#{searchKeyword}||'%'
		</if>
		<if test="searchCondition=='nickname'">
			AND nickname LIKE '%'||#{searchKeyword}||'%'
		</if>
	</select>

	<!-- EXCEL , PDF를 나타내기 위함. -->
	<select id="selectBoardList" resultType="adminmember">
		select seq , email, nickname, age, gender, ticket_id,
		cert, ban, join_date 
		from member
		order by seq;
	</select>

	<select id="getMemberModifyInfo" resultType="adminmember">
		select seq , email,
		nickname , age , gender , ticket_id , cert , ban , join_date from
		member where
		seq = #{seq}
	</select>

	<insert id="insertMember" parameterType="adminmember">
		insert into
		member(email,nickname, age, gender, ticket_id, cert, ban,join_date)
		values(#{email}, #{nickname}, #{age}, #{gender}, #{ticket_id},
		#{cert}, #{ban}, current_timestamp)
	</insert>

	<update id="modifyMember" parameterType="adminmember">
		update member set
		email =
		#{email},
		nickname = #{nickname},
		age = #{age},
		gender = #{gender},
		ticket_id =
		#{ticket_id},
		cert = #{cert},
		ban = #{ban}		
		where seq = #{seq}
	</update>

	<select id="ageList" resultType="adminmember">
		select * from member
	</select>

</mapper>
